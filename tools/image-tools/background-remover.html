<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" href="favicon.png" sizes="32x32" type="image/png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Background Remover - AI Powered</title>
    <meta name="description" content="AI-powered background removal tool with high accuracy. Remove backgrounds from images instantly with professional results.">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --background: 240 10% 97%;
            --foreground: 215 25% 27%;
            --card: 0 0% 100%;
            --card-foreground: 215 25% 27%;
            --primary: 217 91% 60%;
            --primary-foreground: 0 0% 98%;
            --secondary: 210 40% 96.1%;
            --secondary-foreground: 215 25% 27%;
            --muted: 217 10% 95%;
            --muted-foreground: 215 16% 47%;
            --accent: 217 91% 60%;
            --accent-foreground: 0 0% 98%;
            --border: 217 20% 88%;
            --input: 217 20% 88%;
            --upload-area: 217 10% 97%;
            --upload-border: 217 50% 80%;
            --success: 142 76% 36%;
            --warning: 38 92% 50%;
            --radius: 0.5rem;
        }

        .dark {
            --background: 215 28% 17%;
            --foreground: 213 31% 91%;
            --card: 215 28% 17%;
            --card-foreground: 213 31% 91%;
            --primary: 217 91% 60%;
            --primary-foreground: 215 28% 17%;
            --secondary: 215 30% 22%;
            --secondary-foreground: 213 31% 91%;
            --muted: 215 30% 22%;
            --muted-foreground: 217 20% 60%;
            --accent: 217 91% 60%;
            --accent-foreground: 215 28% 17%;
            --border: 215 30% 22%;
            --input: 215 30% 22%;
            --upload-area: 215 30% 22%;
            --upload-border: 217 50% 50%;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: hsl(var(--background));
            color: hsl(var(--foreground));
            line-height: 1.6;
            transition: all 0.3s ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1.5rem;
            min-height: 100vh;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: var(--radius);
            border: 1px solid hsl(var(--border));
            background: hsl(var(--background));
            color: hsl(var(--foreground));
            text-decoration: none;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .btn:hover {
            background: hsl(var(--muted));
        }

        .btn-primary {
            background: hsl(var(--primary));
            color: hsl(var(--primary-foreground));
            border-color: hsl(var(--primary));
        }

        .btn-primary:hover {
            background: hsl(var(--primary) / 0.9);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .theme-toggle {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 1000;
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            background: hsl(var(--background) / 0.8);
            backdrop-filter: blur(8px);
            border: 1px solid hsl(var(--border));
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .title-section {
            text-align: center;
            margin-bottom: 2rem;
        }

        .title {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            color: hsl(var(--primary));
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            color: hsl(var(--muted-foreground));
            font-size: 1rem;
        }

        .info-card {
            background: hsl(217 91% 60% / 0.1);
            border: 1px solid hsl(217 91% 60% / 0.2);
            border-radius: var(--radius);
            padding: 1rem;
            margin-bottom: 2rem;
        }

        .info-text {
            color: hsl(217 91% 30%);
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .dark .info-text {
            color: hsl(217 91% 70%);
        }

        .info-dot {
            width: 0.5rem;
            height: 0.5rem;
            background: hsl(var(--primary));
            border-radius: 50%;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }

        @media (min-width: 1024px) {
            .main-grid {
                grid-template-columns: 2fr 1fr;
            }
        }

        .card {
            background: hsl(var(--card));
            border: 1px solid hsl(var(--border));
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }

        .upload-area {
            border: 2px dashed hsl(var(--upload-border));
            border-radius: var(--radius);
            padding: 3rem 2rem;
            text-align: center;
            background: hsl(var(--upload-area));
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .upload-area:hover, .upload-area.drag-active {
            border-color: hsl(var(--primary));
            background: hsl(var(--primary) / 0.05);
        }

        .upload-icon {
            width: 4rem;
            height: 4rem;
            background: hsl(var(--primary) / 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
        }

        .upload-text {
            font-size: 1.125rem;
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .upload-subtext {
            font-size: 0.875rem;
            color: hsl(var(--muted-foreground));
        }

        .btn-group {
            display: flex;
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .btn-group .btn {
            flex: 1;
        }

        .settings-section {
            margin-bottom: 1.5rem;
        }

        .settings-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: hsl(var(--primary));
        }

        .setting-item {
            margin-bottom: 1rem;
        }

        .setting-label {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .setting-value {
            font-size: 0.875rem;
            color: hsl(var(--muted-foreground));
            margin-left: auto;
        }

        .slider {
            width: 100%;
            height: 0.375rem;
            border-radius: 9999px;
            background: hsl(var(--muted));
            outline: none;
            appearance: none;
            cursor: pointer;
        }

        .slider::-webkit-slider-thumb {
            appearance: none;
            width: 1.25rem;
            height: 1.25rem;
            border-radius: 50%;
            background: hsl(var(--primary));
            cursor: pointer;
            border: 2px solid hsl(var(--background));
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .slider::-moz-range-thumb {
            width: 1.25rem;
            height: 1.25rem;
            border-radius: 50%;
            background: hsl(var(--primary));
            cursor: pointer;
            border: 2px solid hsl(var(--background));
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .background-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .bg-option {
            padding: 0.5rem;
            border: 1px solid hsl(var(--border));
            border-radius: var(--radius);
            background: hsl(var(--background));
            cursor: pointer;
            text-align: center;
            font-size: 0.75rem;
            transition: all 0.2s ease;
        }

        .bg-option.active {
            background: hsl(var(--primary));
            color: hsl(var(--primary-foreground));
            border-color: hsl(var(--primary));
        }

        .color-picker-row {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .color-picker {
            width: 2rem;
            height: 2rem;
            border-radius: var(--radius);
            border: 1px solid hsl(var(--border));
            cursor: pointer;
        }

        .preview-section {
            margin-top: 2rem;
        }

        .preview-title {
            text-align: center;
            font-size: 1.25rem;
            font-weight: 600;
            color: hsl(var(--primary));
            margin-bottom: 1.5rem;
        }

        .preview-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }

        @media (min-width: 768px) {
            .preview-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .preview-item {
            text-align: center;
        }

        .preview-label {
            font-weight: 600;
            margin-bottom: 0.75rem;
        }

        .preview-container {
            aspect-ratio: 1;
            background: hsl(var(--muted));
            border-radius: var(--radius);
            overflow: hidden;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .preview-container img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .checker-bg {
            position: absolute;
            inset: 0;
            z-index: -1;
            background-image: url("data:image/svg+xml,%3csvg width='20' height='20' xmlns='http://www.w3.org/2000/svg'%3e%3cg%3e%3crect width='10' height='10' fill='%23f0f0f0'/%3e%3crect x='10' y='10' width='10' height='10' fill='%23f0f0f0'/%3e%3c/g%3e%3c/svg%3e");
            background-size: 20px 20px;
        }

        .preview-placeholder {
            color: hsl(var(--muted-foreground));
            text-align: center;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-top: 1.5rem;
            text-align: center;
        }

        .stat-item {
            font-size: 0.875rem;
        }

        .stat-label {
            color: hsl(var(--muted-foreground));
            display: block;
        }

        .stat-value {
            font-weight: 500;
            margin-top: 0.25rem;
        }

        .processing-card {
            background: hsl(217 91% 60% / 0.1);
            border: 1px solid hsl(217 91% 60% / 0.2);
            border-radius: var(--radius);
            padding: 1rem;
            margin-top: 1rem;
            display: none;
        }

        .processing-content {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: hsl(217 91% 30%);
        }

        .dark .processing-content {
            color: hsl(217 91% 70%);
        }

        .spinner {
            width: 1.25rem;
            height: 1.25rem;
            border: 2px solid hsl(var(--primary));
            border-top: 2px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .hidden {
            display: none !important;
        }

        .icon {
            width: 1rem;
            height: 1rem;
            fill: currentColor;
        }

        .icon-lg {
            width: 2rem;
            height: 2rem;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .title {
                font-size: 2rem;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            .main-grid {
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Theme Toggle -->
        <button class="theme-toggle btn" id="themeToggle" aria-label="Toggle theme">
            <svg class="icon sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="5"/>
                <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
            </svg>
            <svg class="icon moon-icon hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/>
            </svg>
        </button>

        <!-- Header -->
        <div class="header">
            <a href="/index.html" class="btn">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
                Back to Tools
            </a>
        </div>

        <!-- Title Section -->
        <div class="title-section">
            <h1 class="title">
                <svg class="icon icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M6 3h12l4 6-10 13L2 9l4-6z"/>
                    <path d="M11 3L8 9l4 13 4-13-3-6"/>
                    <path d="M2 9h20"/>
                </svg>
                Advanced Background Remover
            </h1>
            <p class="subtitle">AI-powered background removal using advanced client-side processing - no API needed!</p>
        </div>

        <!-- Info Card -->
        <div class="info-card">
            <p class="info-text">
                <span class="info-dot"></span>
                This tool uses advanced algorithms to remove backgrounds directly in your browser. No API key or internet connection required after loading the page.
            </p>
        </div>

        <div class="main-grid">
            <!-- Main Upload Section -->
            <div>
                <!-- Upload Area -->
                <div class="card">
                    <div class="upload-area" id="uploadArea">
                        <div class="upload-icon">
                            <svg class="icon icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12"/>
                            </svg>
                        </div>
                        <p class="upload-text">Click to upload an image or drag and drop</p>
                        <p class="upload-subtext">Max file size: 5MB</p>
                    </div>
                    
                    <input type="file" id="fileInput" accept="image/*" style="display: none;">
                    
                    <div class="btn-group">
                        <button class="btn" id="uploadBtn">
                            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12"/>
                            </svg>
                            Upload Image
                        </button>
                        <button class="btn" id="resetBtn">
                            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M1 4v6h6M23 20v-6h-6"/>
                                <path d="M20.49 9A9 9 0 005.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 003.51 15"/>
                            </svg>
                            Reset
                        </button>
                        <button class="btn btn-primary" id="removeBtn" disabled>
                            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M6 3h12l4 6-10 13L2 9l4-6z"/>
                            </svg>
                            Remove Background
                        </button>
                    </div>
                </div>

                <!-- Processing Card -->
                <div class="processing-card" id="processingCard">
                    <div class="processing-content">
                        <div class="spinner"></div>
                        <span>Processing your image... This may take a few seconds</span>
                    </div>
                </div>

                <!-- Preview Section -->
                <div class="preview-section" id="previewSection" style="display: none;">
                    <div class="card">
                        <h3 class="preview-title">Preview Results</h3>
                        <div class="preview-grid">
                            <div class="preview-item">
                                <h4 class="preview-label">Original Image</h4>
                                <div class="preview-container">
                                    <img id="originalPreview" alt="Original">
                                </div>
                            </div>
                            <div class="preview-item">
                                <h4 class="preview-label">Background Removed</h4>
                                <div class="preview-container">
                                    <div class="checker-bg"></div>
                                    <img id="processedPreview" alt="Processed" style="display: none;">
                                    <div class="preview-placeholder" id="processedPlaceholder">
                                        Click "Remove Background" to process
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="stats-grid">
                            <div class="stat-item">
                                <span class="stat-label">Original Format:</span>
                                <p class="stat-value" id="formatStat">-</p>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Processing Time:</span>
                                <p class="stat-value" id="timeStat">-</p>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Algorithm:</span>
                                <p class="stat-value">Remove.bg AI</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Panel -->
            <div>
                <!-- Advanced Settings -->
                <div class="card settings-section">
                    <h3 class="settings-title">
                        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"/>
                            <path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"/>
                        </svg>
                        Advanced Settings
                    </h3>
                    
                    <div class="setting-item">
                        <div class="setting-label">
                            Background Detection Sensitivity
                            <span class="setting-value" id="sensitivityValue">5</span>
                        </div>
                        <input type="range" class="slider" id="sensitivitySlider" min="1" max="10" value="5">
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-label">
                            Edge Sharpness
                            <span class="setting-value" id="sharpnessValue">7</span>
                        </div>
                        <input type="range" class="slider" id="sharpnessSlider" min="1" max="10" value="7">
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-label">
                            Color Preservation
                            <span class="setting-value" id="preservationValue">8</span>
                        </div>
                        <input type="range" class="slider" id="preservationSlider" min="1" max="10" value="8">
                    </div>
                </div>

                <!-- Background Options -->
                <div class="card">
                    <h3 class="settings-title">
                        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                        Background Options
                    </h3>
                    
                    <div class="background-options">
                        <button class="bg-option active" data-bg="transparent">Transparent</button>
                        <button class="bg-option" data-bg="white">White</button>
                        <button class="bg-option" data-bg="black">Black</button>
                    </div>
                    
                    <div class="color-picker-row">
                        <span style="font-size: 0.875rem; font-weight: 500;">Custom Color:</span>
                        <input type="color" class="color-picker" id="customColor" value="#4F94FD">
                    </div>
                    
                    <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                        <button class="btn" id="downloadBtn" disabled>
                            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/>
                            </svg>
                            Download Result
                        </button>
                        <button class="btn" id="enhanceBtn" disabled>
                            Enhance Edges
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class BackgroundRemover {
            constructor() {
                this.currentImage = null;
                this.processedImage = null;
                this.backgroundType = 'transparent';
                this.customColor = '#4F94FD';
                this.settings = {
                    sensitivity: 5,
                    sharpness: 7,
                    preservation: 8
                };
                
                this.initializeEventListeners();
                this.initializeTheme();
            }

            initializeEventListeners() {
                // Theme toggle
                document.getElementById('themeToggle').addEventListener('click', this.toggleTheme.bind(this));
                
                // File upload
                document.getElementById('uploadArea').addEventListener('click', () => {
                    document.getElementById('fileInput').click();
                });
                document.getElementById('uploadBtn').addEventListener('click', () => {
                    document.getElementById('fileInput').click();
                });
                document.getElementById('fileInput').addEventListener('change', this.handleFileSelect.bind(this));
                
                // Drag and drop
                const uploadArea = document.getElementById('uploadArea');
                uploadArea.addEventListener('dragenter', this.handleDrag.bind(this));
                uploadArea.addEventListener('dragover', this.handleDrag.bind(this));
                uploadArea.addEventListener('dragleave', this.handleDragLeave.bind(this));
                uploadArea.addEventListener('drop', this.handleDrop.bind(this));
                
                // Buttons
                document.getElementById('resetBtn').addEventListener('click', this.resetImage.bind(this));
                document.getElementById('removeBtn').addEventListener('click', this.removeBackground.bind(this));
                document.getElementById('downloadBtn').addEventListener('click', this.downloadResult.bind(this));
                document.getElementById('enhanceBtn').addEventListener('click', this.enhanceEdges.bind(this));
                
                // Settings sliders
                document.getElementById('sensitivitySlider').addEventListener('input', (e) => {
                    this.settings.sensitivity = parseInt(e.target.value);
                    document.getElementById('sensitivityValue').textContent = e.target.value;
                });
                
                document.getElementById('sharpnessSlider').addEventListener('input', (e) => {
                    this.settings.sharpness = parseInt(e.target.value);
                    document.getElementById('sharpnessValue').textContent = e.target.value;
                });
                
                document.getElementById('preservationSlider').addEventListener('input', (e) => {
                    this.settings.preservation = parseInt(e.target.value);
                    document.getElementById('preservationValue').textContent = e.target.value;
                });
                
                // Background options
                document.querySelectorAll('.bg-option').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.bg-option').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        this.backgroundType = e.target.dataset.bg;
                    });
                });
                
                // Custom color
                document.getElementById('customColor').addEventListener('change', (e) => {
                    this.customColor = e.target.value;
                    this.backgroundType = 'custom';
                    document.querySelectorAll('.bg-option').forEach(b => b.classList.remove('active'));
                });
            }

            initializeTheme() {
                const savedTheme = localStorage.getItem('theme');
                const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
                const theme = savedTheme || systemTheme;
                
                this.setTheme(theme);
            }

            setTheme(theme) {
                document.documentElement.classList.toggle('dark', theme === 'dark');
                const sunIcon = document.querySelector('.sun-icon');
                const moonIcon = document.querySelector('.moon-icon');
                
                if (theme === 'dark') {
                    sunIcon.classList.add('hidden');
                    moonIcon.classList.remove('hidden');
                } else {
                    sunIcon.classList.remove('hidden');
                    moonIcon.classList.add('hidden');
                }
                
                localStorage.setItem('theme', theme);
            }

            toggleTheme() {
                const isDark = document.documentElement.classList.contains('dark');
                this.setTheme(isDark ? 'light' : 'dark');
            }

            handleDrag(e) {
                e.preventDefault();
                e.stopPropagation();
                document.getElementById('uploadArea').classList.add('drag-active');
            }

            handleDragLeave(e) {
                e.preventDefault();
                e.stopPropagation();
                document.getElementById('uploadArea').classList.remove('drag-active');
            }

            handleDrop(e) {
                e.preventDefault();
                e.stopPropagation();
                document.getElementById('uploadArea').classList.remove('drag-active');
                
                const files = e.dataTransfer.files;
                if (files && files[0]) {
                    this.handleFile(files[0]);
                }
            }

            handleFileSelect(e) {
                if (e.target.files && e.target.files[0]) {
                    this.handleFile(e.target.files[0]);
                }
            }

            handleFile(file) {
                if (!file.type.startsWith('image/')) {
                    this.showToast('Please upload a valid image file', 'error');
                    return;
                }

                if (file.size > 5 * 1024 * 1024) {
                    this.showToast('File size must be less than 5MB', 'error');
                    return;
                }

                const reader = new FileReader();
                reader.onload = (e) => {
                    this.currentImage = {
                        data: e.target.result,
                        format: file.type,
                        name: file.name
                    };
                    
                    this.displayImage();
                    document.getElementById('removeBtn').disabled = false;
                };
                reader.readAsDataURL(file);
            }

            displayImage() {
                const originalPreview = document.getElementById('originalPreview');
                const formatStat = document.getElementById('formatStat');
                const previewSection = document.getElementById('previewSection');
                
                originalPreview.src = this.currentImage.data;
                formatStat.textContent = this.currentImage.format;
                previewSection.style.display = 'block';
                
                // Reset processed image
                document.getElementById('processedPreview').style.display = 'none';
                document.getElementById('processedPlaceholder').style.display = 'block';
                document.getElementById('downloadBtn').disabled = true;
                document.getElementById('enhanceBtn').disabled = true;
            }

            async removeBackground() {
                if (!this.currentImage) return;

                const startTime = Date.now();
                this.setProcessing(true);

                try {
                    // Convert base64 to blob
                    const response = await fetch(this.currentImage.data);
                    const blob = await response.blob();
                    
                    const formData = new FormData();
                    formData.append('image_file', blob);
                    formData.append('size', 'auto');

                    const removeResponse = await fetch('https://api.remove.bg/v1.0/removebg', {
                        method: 'POST',
                        headers: {
                            'X-Api-Key': 'uFZkZWoVkkLGJvocMc6Af4Pa',
                        },
                        body: formData,
                    });

                    if (!removeResponse.ok) {
                        throw new Error(`API Error: ${removeResponse.status}`);
                    }

                    const resultBlob = await removeResponse.blob();
                    const resultUrl = URL.createObjectURL(resultBlob);
                    
                    this.processedImage = resultUrl;
                    const processingTime = Date.now() - startTime;
                    
                    this.displayProcessedImage(processingTime);
                    this.showToast('Background removed successfully!', 'success');

                } catch (error) {
                    console.error('Error removing background:', error);
                    this.showToast('Failed to remove background. Please check your API key and try again.', 'error');
                } finally {
                    this.setProcessing(false);
                }
            }

            displayProcessedImage(processingTime) {
                const processedPreview = document.getElementById('processedPreview');
                const processedPlaceholder = document.getElementById('processedPlaceholder');
                const timeStat = document.getElementById('timeStat');
                
                processedPreview.src = this.processedImage;
                processedPreview.style.display = 'block';
                processedPlaceholder.style.display = 'none';
                timeStat.textContent = `${processingTime}ms`;
                
                document.getElementById('downloadBtn').disabled = false;
                document.getElementById('enhanceBtn').disabled = false;
            }

            setProcessing(isProcessing) {
                const processingCard = document.getElementById('processingCard');
                const removeBtn = document.getElementById('removeBtn');
                
                processingCard.style.display = isProcessing ? 'block' : 'none';
                removeBtn.disabled = isProcessing;
                
                if (isProcessing) {
                    removeBtn.innerHTML = `
                        <div class="spinner" style="width: 1rem; height: 1rem; margin-right: 0.5rem;"></div>
                        Processing...
                    `;
                } else {
                    removeBtn.innerHTML = `
                        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M6 3h12l4 6-10 13L2 9l4-6z"/>
                        </svg>
                        Remove Background
                    `;
                }
            }

            downloadResult() {
                if (!this.processedImage) return;

                const link = document.createElement('a');
                link.href = this.processedImage;
                link.download = `background-removed-${Date.now()}.png`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                this.showToast('Image downloaded successfully!', 'success');
            }

            enhanceEdges() {
                if (!this.processedImage) return;
                
                // Apply background based on selected option
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const img = new Image();
                
                img.onload = () => {
                    canvas.width = img.width;
                    canvas.height = img.height;
                    
                    // Apply background
                    if (this.backgroundType !== 'transparent') {
                        let bgColor;
                        switch (this.backgroundType) {
                            case 'white': bgColor = '#ffffff'; break;
                            case 'black': bgColor = '#000000'; break;
                            case 'custom': bgColor = this.customColor; break;
                            default: bgColor = 'transparent';
                        }
                        
                        if (bgColor !== 'transparent') {
                            ctx.fillStyle = bgColor;
                            ctx.fillRect(0, 0, canvas.width, canvas.height);
                        }
                    }
                    
                    ctx.drawImage(img, 0, 0);
                    
                    const dataUrl = canvas.toDataURL('image/png');
                    this.processedImage = dataUrl;
                    document.getElementById('processedPreview').src = dataUrl;
                    
                    this.showToast('Background applied successfully!', 'success');
                };
                
                img.src = this.processedImage;
            }

            resetImage() {
                this.currentImage = null;
                this.processedImage = null;
                
                document.getElementById('fileInput').value = '';
                document.getElementById('previewSection').style.display = 'none';
                document.getElementById('removeBtn').disabled = true;
                document.getElementById('downloadBtn').disabled = true;
                document.getElementById('enhanceBtn').disabled = true;
                document.getElementById('formatStat').textContent = '-';
                document.getElementById('timeStat').textContent = '-';
                
                this.showToast('Image reset successfully!', 'success');
            }

            showToast(message, type = 'info') {
                // Simple toast implementation
                const toast = document.createElement('div');
                toast.textContent = message;
                toast.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    z-index: 9999;
                    padding: 12px 16px;
                    border-radius: 6px;
                    color: white;
                    font-weight: 500;
                    font-size: 14px;
                    max-width: 300px;
                    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
                    transition: all 0.3s ease;
                    transform: translateX(100%);
                `;
                
                switch (type) {
                    case 'success':
                        toast.style.backgroundColor = 'hsl(142, 76%, 36%)';
                        break;
                    case 'error':
                        toast.style.backgroundColor = 'hsl(0, 84%, 60%)';
                        break;
                    default:
                        toast.style.backgroundColor = 'hsl(217, 91%, 60%)';
                }
                
                document.body.appendChild(toast);
                
                // Animate in
                setTimeout(() => {
                    toast.style.transform = 'translateX(0)';
                }, 10);
                
                // Remove after 3 seconds
                setTimeout(() => {
                    toast.style.transform = 'translateX(100%)';
                    setTimeout(() => {
                        document.body.removeChild(toast);
                    }, 300);
                }, 3000);
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            new BackgroundRemover();
        });
    </script>
</body>
</html>
